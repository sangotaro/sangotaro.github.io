/**
 * Modules in this bundle
 * 
 * component-emitter:
 *   license: MIT
 *   maintainers: tootallnate <nathan@tootallnate.net>, tjholowaychuk <tj@vision-media.ca>, rauchg <rauchg@gmail.com>, retrofox <rdsuarez@gmail.com>, coreh <thecoreh@gmail.com>, forbeslindesay <forbes@lindesay.co.uk>, kelonye <kelonyemitchel@gmail.com>, mattmueller <mattmuelle@gmail.com>, yields <yields@icloud.com>, anthonyshort <antshort@gmail.com>, jongleberry <jonathanrichardong@gmail.com>, ianstormtaylor <ian@ianstormtaylor.com>, cristiandouce <cristian@gravityonmars.com>, swatinem <arpad.borsos@googlemail.com>, stagas <gstagas@gmail.com>, amasad <amjad.masad@gmail.com>, juliangruber <julian@juliangruber.com>, shtylman <shtylman@gmail.com>, calvinfo <calvin@calv.info>, dominicbarnes <dominic@dbarnes.info>, blakeembrey <hello@blakeembrey.com>, timoxley <secoif@gmail.com>, jonathanong <jonathanrichardong@gmail.com>, queckezz <fabian.eichenberger@gmail.com>, nami-doc <vendethiel@hotmail.fr>, clintwood <clint@anotherway.co.za>, thehydroimpulse <dnfagnan@gmail.com>, stephenmathieson <me@stephenmathieson.com>, trevorgerhardt <trevorgerhardt@gmail.com>, timaschew <timaschew@gmail.com>, hughsk <hughskennedy@gmail.com>
 *   version: 1.2.0
 * 
 * growthpush-javascript:
 *   version: 0.1.0
 * 
 * nanoajax:
 *   license: MIT
 *   author: Jon Eisen <jon@joneisen.me>
 *   maintainers: yanatan16 <jon.m.eisen@gmail.com>
 *   version: 0.3.1
 * 
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.GrowthPush=t()}}(function(){return function t(e,n,r){function o(a,s){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var p=n[a]={exports:{}};e[a][0].call(p.exports,function(t){var n=e[a][1][t];return o(n?n:t)},p,p.exports,t,e,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){var r=t("nanoajax"),o=function(){function t(t,e){void 0===e&&(e=0),this.baseUrl=t,this.timeout=e}return t.prototype.get=function(t,e,n,r){return this._request("GET",t,e,n,r)},t.prototype.post=function(t,e,n,r){return this._request("POST",t,e,n,r)},t.prototype.put=function(t,e,n,r){return this._request("PUT",t,e,n,r)},t.prototype["delete"]=function(t,e,n,r){return this._request("DELETE",t,e,n,r)},t.prototype._request=function(t,e,n,r,o){"jsonp"===n.dataType?this._requestByJsonp("GET",e,n,r,o):this._requestByXhr(t,e,n,r,o)},t.prototype._requestByJsonp=function(t,e,n,r,o){var i=this._makeParamsArray(n.params),a="growthbeat"+Math.random().toString(36).slice(-8);i=i.concat("callback="+a);var s=this.baseUrl+e+"?"+i.join("&"),c=document.createElement("script");c.async=!0,c.src=s,window[a]=function(t){delete window[a],document.body.removeChild(c),r(t,200)},c.onerror=function(t){o()},document.body.appendChild(c)},t.prototype._requestByXhr=function(t,e,n,o,i){var a=this._makeParamsArray(n.params),s={method:t,url:this.baseUrl+e,withCredentials:n.withCredentials};"GET"===t?s.url=s.url+"?"+a.join("&"):s.body=a.join("&"),r.ajax(s,function(t,e){if(200===t){var n=JSON.parse(e);o(n,t)}else{var r={};i(r,t)}})},t.prototype._makeParamsArray=function(t){var e=null==t?{}:t,n=Object.keys(e).map(function(t){var n="";return n="object"==typeof e[t]?JSON.stringify(e[t]):e[t],encodeURIComponent(t)+"="+encodeURIComponent(n)});return n},t}();e.exports=o},{nanoajax:7}],2:[function(t,e,n){function r(t){if(!l){if(l=!0,null==t.environment&&(t.environment="production"),"development"!==t.environment&&"production"!==t.environment)throw new Error("GrowthPush: unsupported environment: "+t.environment);d=t,E()}}function o(t,e){if(l&&null!=t){var n=JSON.parse(a.get("growthpush.tag:"+t));(!n||n.value!==e&&(null!=n.value||""!==e&&null!=e))&&_(function(n){var r={clientId:n.getId(),code:n.getCode(),name:t};null!=e&&""!==e&&(r.value=e),p.post("1/tags",{params:r},function(e,n){a.set("growthpush.tag:"+t,JSON.stringify(e))},function(t,e){})})}}function i(t,e){l&&null!=t&&_(function(n){var r={clientId:n.getId(),code:n.getCode(),name:t};null!=e&&""!==e&&(r.value=e),p.post("1/events",{params:r},function(t,e){},function(t,e){})})}var a=t("../utils/local-storage-wrapper"),s=t("./model/client"),c=t("./http/http-client"),u="https://api.growthpush.com/",p=new c(u),l=!1,d=null,f=null,h=function(){return"showNotification"in ServiceWorkerRegistration.prototype?"denied"===Notification.permission?Promise.reject(new Error("The user has blocked notifications.")):"PushManager"in window?navigator.serviceWorker.ready.then(function(t){var e=function(n){t.removeEventListener("updatefound",e),E()};return t.addEventListener("updatefound",e),Promise.resolve(t)}):Promise.reject(new Error("Push messaging isn't supported.")):Promise.reject(new Error("Notifications aren't supported."))},v=function(t){return t.pushManager.getSubscription().then(function(e){return e?Promise.resolve(e):m(t)})["catch"](function(t){return Promise.reject(new Error("Error during getSubscription()"))})},m=function(t){var e={userVisibleOnly:!0};return t.pushManager.subscribe(e).then(function(t){return Promise.resolve(t)})["catch"](function(t){return Promise.reject("denied"===Notification.permission?new Error("Permission for Notifications was denied"):new Error("Unable to subscribe to push."))})},g=function(t){var e=s.load();return null!=e&&e.getApplicationId()===d.applicationId?e.getToken()===I(t)&&e.getEnvironment()===d.environment?(f=e,Promise.resolve({client:e,subscription:t})):y(e,t):w(t)},w=function(t){return new Promise(function(e,n){var r=s.create({applicationId:d.applicationId,credentialId:d.credentialId,environment:d.environment,token:I(t)});r.on("created",function(){f=r,s.save(r),e({client:r,subscription:t})}),r.on("error",function(){n(new Error("Error during creating client"))})})},y=function(t,e){return new Promise(function(n,r){var o=s.update(t,{code:t.getCode(),token:I(e),environment:d.environment});o.on("updated",function(){f=o,s.save(o),n({client:o,subscription:e})}),o.on("error",function(){r(new Error("Error during updating client"))})})},b=function(t){return k({type:"init",data:{applicationId:d.applicationId,credentialId:d.credentialId,title:d.appName,icon:d.icon,clickEventName:d.clickEventName,clientId:t.client.getId(),code:t.client.getCode()}})},k=function(t){return new Promise(function(e,n){var r=JSON.stringify(t),o=new MessageChannel;o.port1.onmessage=function(t){t.data.error?n(t.data.error):e(t.data)},navigator.serviceWorker.controller.postMessage(r,[o.port2])})},I=function(t){return null==t.subscriptionId?t.endpoint.split("/").pop():t.subscriptionId};n.init=r;var E=function(){"serviceWorker"in navigator&&navigator.serviceWorker.register(d.receiver).then(h).then(v).then(g).then(b).then(function(t){})["catch"](function(t){l=!1})},_=function(t){var e=setInterval(function(){f&&(clearInterval(e),t(f))},500)};n.tag=o,n.track=i},{"../utils/local-storage-wrapper":5,"./http/http-client":1,"./model/client":3}],3:[function(t,e,n){var r=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},o=t("../../utils/local-storage-wrapper"),i=t("../http/http-client"),a=t("component-emitter"),s="https://api.growthpush.com/",c=new i(s),u=function(t){function e(e){t.call(this),null!=e&&this.setData(e)}return r(e,t),e.prototype.setData=function(t){this.id=t.id,this.growthbeatClientId=t.growthbeatClientId,this.token=t.token,this.applicationId=t.applicationId,this.growthbeatApplicationId=t.growthbeatApplicationId,this.code=t.code,this.os=t.os,this.environment=t.environment,this.created=t.created},e.load=function(){var t=o.get("growthpush.client");return null==t?null:new e(JSON.parse(t))},e.save=function(t){if(t){var e={id:t.id,growthbeatClientId:t.growthbeatClientId,token:t.token,applicationId:t.applicationId,growthbeatApplicationId:t.growthbeatApplicationId,code:t.code,os:t.os,environment:t.environment,created:t.created};o.set("growthpush.client",JSON.stringify(e))}},e.create=function(t){var n={params:{applicationId:t.applicationId,secret:t.credentialId,token:t.token,environment:t.environment,os:"android"}},r=new e;return c.post("1/clients",n,function(t,e){r.setData(t),r.emit("created")},function(t,e){r.emit("error")}),r},e.update=function(t,n){var r={params:{token:n.token,environment:n.environment,code:n.code}},o=new e;return c.put("1/clients/"+t.id,r,function(t,e){o.setData(t),o.emit("updated")},function(t,e){o.emit("error")}),o},e.prototype.getId=function(){return this.id},e.prototype.getApplicationId=function(){return this.applicationId},e.prototype.getToken=function(){return this.token},e.prototype.getEnvironment=function(){return this.environment},e.prototype.getCode=function(){return this.code},e}(a);e.exports=u},{"../../utils/local-storage-wrapper":5,"../http/http-client":1,"component-emitter":6}],4:[function(t,e,n){var r=t("./growthpush/index");e.exports=r},{"./growthpush/index":2}],5:[function(t,e,n){function r(t){return window.localStorage?localStorage.getItem(t):null}function o(t,e){if(window.localStorage)try{localStorage.setItem(t,e)}catch(n){}}n.get=r,n.set=o},{}],6:[function(t,e,n){function r(t){return t?o(t):void 0}function o(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}e.exports=r,r.prototype.on=r.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},r.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var r,o=0;o<n.length;o++)if(r=n[o],r===e||r.fn===e){n.splice(o,1);break}return this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n){n=n.slice(0);for(var r=0,o=n.length;o>r;++r)n[r].apply(this,e)}return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}},{}],7:[function(t,e,n){(function(t){function e(){if(t.XMLHttpRequest)return new t.XMLHttpRequest;try{return new t.ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){}throw new Error("no xmlhttp request able to be created")}function r(t,e,n){t[e]=t[e]||n}n.ajax=function(t,n){"string"==typeof t&&(t={url:t});var o=t.headers||{},i=t.body,a=t.method||(i?"POST":"GET"),s=t.withCredentials||!1,c=e();c.onreadystatechange=function(){4==c.readyState&&n(c.status,c.responseText,c)},i&&(r(o,"X-Requested-With","XMLHttpRequest"),r(o,"Content-Type","application/x-www-form-urlencoded")),c.open(a,t.url,!0),c.withCredentials=s;for(var u in o)c.setRequestHeader(u,o[u]);c.send(i)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[4])(4)}),function(t){var e;"function"==typeof CustomEvent?e=new CustomEvent("growthpushReady",{}):(e=t.createEvent("Event"),e.initEvent("growthpushReady",!0,!0)),t.dispatchEvent(e)}(document);